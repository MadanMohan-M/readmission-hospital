{% extends "base.html" %}

{% block title %}Assessment Results - HealthGuard AI{% endblock %}

{% block extra_css %}
<style>
    .results-container { max-width: 1000px; margin: 0 auto; }
    .results-header {
        background: white; border-radius: 16px; padding: 30px; margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.06); text-align: center;
    }
    .results-title { font-size: 2.2em; font-weight: 700; color: #1e293b; margin-bottom: 16px; }
    .patient-info { color: #64748b; font-size: 1.1em; }
    
    .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    
    .risk-summary {
        background: white; border-radius: 20px; padding: 30px; text-align: center;
        box-shadow: 0 15px 50px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;
    }
    .risk-gauge { position: relative; width: 280px; height: 140px; margin: 20px auto; }
    .gauge-score {
        position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
        font-size: 3em; font-weight: 700; color: #1e293b;
    }
    .risk-percentage { font-size: 1.2em; color: #64748b; margin-top: 10px; }
    
    .risk-badge {
        display: inline-block; padding: 12px 24px; border-radius: 30px; font-weight: 700;
        font-size: 1.1em; color: white; margin: 20px 0;
    }
    .risk-high { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .risk-medium { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .risk-low { background: linear-gradient(135deg, #10b981, #059669); }
    
    .recommendations {
        background: white; border-radius: 20px; padding: 30px;
        box-shadow: 0 15px 50px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;
    }
    .recommendations-title { font-size: 1.4em; font-weight: 600; margin-bottom: 20px; color: #1e293b; }
    .recommendation-item {
        background: #f8fafc; border-left: 4px solid #3b82f6; padding: 16px 20px;
        margin-bottom: 16px; border-radius: 0 8px 8px 0;
    }
    .recommendation-priority { font-weight: 600; color: #3b82f6; margin-bottom: 4px; }
    .recommendation-text { color: #4b5563; }
    
    .action-buttons { text-align: center; margin-top: 30px; }
    .action-buttons .btn { margin: 0 10px; }
    
    .patient-data {
        background: white; border-radius: 16px; padding: 24px; margin-top: 30px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.06); border: 1px solid #e2e8f0;
    }
    .data-section { margin-bottom: 24px; }
    .data-title { font-size: 1.2em; font-weight: 600; color: #1e293b; margin-bottom: 12px; }
    .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    .data-item { background: #f8fafc; padding: 12px 16px; border-radius: 8px; }
    .data-label { font-size: 0.9em; color: #64748b; margin-bottom: 4px; }
    .data-value { font-weight: 600; color: #1e293b; }
    
    @media (max-width: 768px) {
        .results-grid { grid-template-columns: 1fr; }
        .data-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="results-container">
    <div class="results-header">
        <div class="results-title">ðŸ“‹ Assessment Complete</div>
        <div class="patient-info">
            Patient ID: <strong>{{ result.id }}</strong> â€¢ 
            Assessed by: <strong>{{ result.assessed_by }}</strong> â€¢ 
            <span style="color: #10b981;">{{ result.timestamp[:10] }}</span>
        </div>
    </div>

    <div class="results-grid">
        <div class="risk-summary">
            <h3 style="margin-bottom: 20px; color: #1e293b;">ðŸŽ¯ Risk Assessment</h3>
            
            <div class="risk-gauge">
                <svg width="280" height="140" viewBox="0 0 280 140">
                    <defs>
                        <linearGradient id="riskGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#10b981"/>
                            <stop offset="50%" style="stop-color:#f59e0b"/>
                            <stop offset="100%" style="stop-color:#ef4444"/>
                        </linearGradient>
                    </defs>
                  
                </svg>
                <div class="gauge-score">{{ result.probability }}%</div>
            </div>
            
            <div class="risk-badge risk-{{ result.risk_color }}">
                {{ result.risk_level }} Risk Patient
            </div>
            
            <div class="risk-percentage">
                Readmission probability: {{ result.probability }}%
            </div>
        </div>

        <div class="recommendations">
            <div class="recommendations-title">ðŸ©º Clinical Recommendations</div>
            
            {% if result.risk_level == 'High' %}
            <div class="recommendation-item">
                <div class="recommendation-priority">HIGH PRIORITY</div>
                <div class="recommendation-text">
                    Implement enhanced discharge planning with post-discharge follow-up within 48-72 hours
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-priority">MEDICATION REVIEW</div>
                <div class="recommendation-text">
                    Comprehensive medication reconciliation and adherence counseling recommended
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-priority">CARE COORDINATION</div>
                <div class="recommendation-text">
                    Consider case management referral for transition of care support
                </div>
            </div>
            {% elif result.risk_level == 'Medium' %}
            <div class="recommendation-item">
                <div class="recommendation-priority">STANDARD MONITORING</div>
                <div class="recommendation-text">
                    Schedule routine follow-up appointment within 7-14 days of discharge
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-priority">PATIENT EDUCATION</div>
                <div class="recommendation-text">
                    Provide comprehensive discharge instructions and symptom monitoring guidance
                </div>
            </div>
            {% else %}
            <div class="recommendation-item">
                <div class="recommendation-priority">LOW RISK</div>
                <div class="recommendation-text">
                    Standard discharge procedures with routine outpatient follow-up as appropriate
                </div>
            </div>
            <div class="recommendation-item">
                <div class="recommendation-priority">MAINTENANCE</div>
                <div class="recommendation-text">
                    Continue current care plan with standard monitoring protocols
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('predict_page') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> New Assessment
        </a>
        <a href="{{ url_for('history') }}" class="btn" style="background: #f1f5f9; color: #64748b;">
            <i class="fas fa-history"></i> View All Records
        </a>
        <button onclick="window.print()" class="btn" style="background: #dbeafe; color: #1e40af;">
            <i class="fas fa-print"></i> Print Results
        </button>
    </div>

    <div class="patient-data">
        <div class="data-section">
            <div class="data-title">ðŸ“Š Clinical Data Summary</div>
            <div class="data-grid">
                <div class="data-item">
                    <div class="data-label">Age Group</div>
                    <div class="data-value">{{ result.input_data.age or 'N/A' }}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Time in Hospital</div>
                    <div class="data-value">{{ result.input_data.time_in_hospital or 'N/A' }} days</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Total Medications</div>
                    <div class="data-value">{{ result.input_data.n_medications or 'N/A' }}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Lab Procedures</div>
                    <div class="data-value">{{ result.input_data.n_lab_procedures or 'N/A' }}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">A1C Test</div>
                    <div class="data-value">{{ result.input_data.A1Ctest | title or 'N/A' }}</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Medical Specialty</div>
                    <div class="data-value">{{ result.input_data.medical_specialty or 'N/A' }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}